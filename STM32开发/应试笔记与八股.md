---
number headings: auto, first-level 2, max 6, 1.1
---
#嵌入式 #应试笔记与八股 

## 1 目录

```toc
```

## 2 时钟系统

### 2.1 讲一下STM32的时钟系统

1. 以STM32F1系列为例，其系统时钟有两个时钟源，分别为内部时钟源和外部时钟源。而少数其他系列产品可能还有MSI等内置时钟源。STM32F1的内部时钟源频率为8MHz，外部时钟源的频率取决于外接的晶振频率，通常也为8Mhz。
2. 在选定了系统时钟源之后，可以通过RCC设置分频器或PLL锁相环进行分频和倍频，调节为合适的系统时钟频率。
3. 而STM32F1的两个外设时钟源APB1和APB2是基于系统时钟进行分频得到的，分别对应APB1和APB2的外设频率。
4. 除了上述系统时钟系统源以外，STM32还有RTC时钟，STM32的RTC时钟也有两个时钟源，其内部集成的时钟源频率为40KHz，外部时钟源取决于具体的RTC晶振频率，往往为32.768KHz。

### 2.2 在STM32启动过程中，系统时钟树初始化之前，系统时钟是怎么样的

1. 通常STM32至少有外部时钟 `HSE` 和内部时钟 `HSI` 两个时钟源
2. 系统时钟通常指 `SYSCLK` ，此外还有 `AHB` 、`APB` 等外设时钟系统
3. 在时钟树初始化之前，默认时钟源为 `HSI` ，且 `PLL` 默认关闭，没有分频和倍频
4. 因此在系统初始化之前，通常 `SYSCLK` 、`AHB` 、`APB` 等均为 `HSI` 对应的频率

## 3 外设接口

### 3.1 ADC

#### 3.1.1 讲一下STM32的ADC采样如何配置和使用

1. ADC的总体配置步骤为：
	1. 配置全局的系统时钟
	2. 使用RCC开启ADC接口
	3. 开启ADC对应的通道、采样时间
	4. 配置ADC的运行参数(例如数据分辨率、数据对其方式、外部触发源、是否连续转换等)
	5. 进行ADC校准
	6. 配置输入通道对应的GPIO，应当配置为无上下拉模式的模拟输入模式。若需要开启多通道ADC，则可以使用或运算一次配置多个GPIO。
	7. 此时就已经完成了普通的轮询ADC配置
2. 但是STM32的ADC一般结合DMA进行使用，其需要在上述步骤的基础上完成如下的配置：
	8. 启用ADC接口所对应的DMA通道的时钟
	9. 开启ADC的连续转换功能
	10. 为DMA分配一片内存，用于存储ADC的数据
	11. 配置DMA为从内存到外设，配置DMA的内存地址自动增加，将ADC外设数据源寄存器和上述内存地址填入配置结构体，初始化DMA。
	12. 配置ADC，使其在<span style="background:#fff88f"><font color="#c00000">每一个通道</font></span>的转换完成后发送DMA数据传输请求

#### 3.1.2 讲一下STM32的ADC校准通常都在什么时候进行，校准时都做了什么

1. STM32的ADC校准主要是用于减小因内部电容器组的变化而造成的准精度误差。
2. STM32的ADC校准会做如下的工作：
	1. 重置校准寄存器，清除之前的校准结果
	2. 为每一个电容器计算出一个误差修正码
	3. 误差修正码会被存储到寄存器中的校准码中
3. 在实际应用中，STM32的校准通常在如下情况下进行：
	1. 系统上电初期
	2. 环境温度发生变化时
	3. 在高精度测量场景可能需要频繁校准
